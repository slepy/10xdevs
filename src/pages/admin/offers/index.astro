---
import AdminLayout from "../../../layouts/AdminLayout.astro";
import { BaseButton, BaseHeader } from "../../../components/base";
import { OffersTable } from "../../../components/admin/OffersTable";
import type { ApiResponse, OfferDTO } from "../../../types";

// Fetch offers from API endpoint instead of direct service call
const response = await fetch(`${Astro.url.origin}/api/offers`, {
  headers: {
    Cookie: Astro.request.headers.get("Cookie") || "",
  },
});

let offers: OfferDTO[] = [];

if (response.ok) {
  const data = (await response.json()) as ApiResponse<OfferDTO[]>;
  offers = data.data || [];
}
// If response fails, offers will remain empty array
---

<AdminLayout title="Zarządzaj Ofertami">
  <BaseHeader title="Zarządzaj Ofertami" client:only="react">
    <BaseButton href="/admin/offers/create">Dodaj nową ofertę</BaseButton>
  </BaseHeader>

  <OffersTable offers={offers} client:load />
</AdminLayout>
